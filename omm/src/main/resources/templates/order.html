<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주문 페이지</title>
    <script src="https://js.tosspayments.com/v1/payment-widget"></script>
    <script th:src="@{/js/order.js}"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <!-- 브랜드명이나 로고 -->
        <a class="navbar-brand" href="/">Your Brand</a>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <!-- 중앙에 위치한 항목 (예: 네비게이션 링크) -->
            <ul class="navbar-nav me-auto">
                <!-- 여기에 다른 네비게이션 항목이 있을 수 있습니다 -->
            </ul>
            <!-- 오른쪽에 위치한 로그인/회원가입 버튼 -->
            <ul class="navbar-nav">
                <li sec:authorize="isAnonymous()" class="nav-item"><a class="nav-link active" aria-current="page" th:href="@{/login}">로그인</a></li>
                <li sec:authorize="isAnonymous()" class="nav-item"><a class="nav-link" th:href="@{/join}">회원가입</a></li>
            </ul>
        </div>
    </div>
</nav>
<!-- 상품 정보 영역 -->
<div class="container my-5">
    <div class="title">상품 정보</div>
    <div class="col-md-6">
    </div>
    <!-- 할인 쿠폰 -->
<form id="discount-coupon">
    <input type="checkbox" id="coupon"/>5,000원 할인받기
</form>
<!-- 결제 방법 영역-->
<div class="title">결제 방법</div>
<div id="payment-method"></div>
<div id="agreement"></div>

<!-- 결제 버튼 -->
<button id="payment-button">결제하기</button>
<footer class="py-5 bg-dark">
    <div class="container"><p class="m-0 text-center text-white">&copy; Your Website 2023</p></div>
</footer>
</div>
</body>
<script>
    const clientKey = 'test_gck_docs_Ovk5rk1EwkEbP0W43n07xlzm' // 상점을 특정하는 키
    const customerKey = 'A1b_c-D@eF=9gH.IjKlMnOpQrStUvWxYz12345678' // 결제 고객을 특정하는 키
    const amount = 15_000 // 결제 금액
    const couponAmount = 5_000 // 할인 쿠폰 금액

    /*결제위젯 영역 렌더링*/
    const paymentWidget = PaymentWidget(clientKey, customerKey) // 회원 결제 초기화
    // const paymentWidget = PaymentWidget(clientKey, PaymentWidget.ANONYMOUS) // 비회원 결제 초기화
    paymentMethods = paymentWidget.renderPaymentMethods('#payment-method', amount)

    /*약관 영역 렌더링*/
    const paymentAgreement = paymentWidget.renderAgreement('#agreement')
    	document.querySelector("#payment-button").addEventListener("click",()=>{
		    paymentWidget.requestPayment({
		    	orderId: 'AD8aZDpbzXs4EQa-UkI6',
		    	orderName: '토스 티셔츠 외 2건',
		    	successUrl: 'http://localhost:8080/success',
		    	failUrl: 'http://localhost:8080/fail',
		    	customerEmail: 'customer123@gmail.com',
		    	customerName: '김토스'
		    }).catch(function (error) {
		    	if (error.code === 'USER_CANCEL') {
		    	// 결제 고객이 결제창을 닫았을 때 에러 처리
		    	} if (error.code === 'INVALID_CARD_COMPANY') {
	            // 유효하지 않은 카드 코드에 대한 에러 처리
	          }
	      })
	  })
            /*할인 쿠폰 적용*/
        document.querySelector("#coupon").addEventListener("click", applyDiscount)

        function applyDiscount(e) {
          if (e.target.checked) {
            paymentMethods.updateAmount(amount - couponAmount, "쿠폰")
          } else {
            paymentMethods.updateAmount(amount)
          }
         }
</script>
</html>
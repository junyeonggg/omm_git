<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>쇼핑몰</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/shop.css" rel="stylesheet"> <!-- Updated CSS 파일 경로 -->
    <style>
        .subcategories {
            display: none; /* 기본적으로 숨김 */
        }
    </style>
</head>
<body>
<div class="container my-5">
    <h1>쇼핑몰</h1>

    <!-- 검색 및 카테고리 필터링 섹션 -->
    <form class="mb-4" method="get" th:action="@{/shop}">
        <input type="text" name="query" placeholder="검색어를 입력하세요" class="form-control mb-2" />
        <div class="d-flex flex-wrap category-btn-group"> <!-- 카테고리 버튼 그룹 추가 -->
            <!-- 전체 카테고리 버튼 -->
            <button type="submit" name="searchCategory" value="" class="btn btn-outline-secondary category-btn">검색</button>

            <!-- 상위 카테고리 버튼들 -->
            <div th:each="category : ${categories}">
                <button type="button" class="btn btn-outline-primary category-btn"
                th:id="'category-' + ${category.categoryId}"
                th:onclick="'toggleSubcategories(' + ${category.categoryId} + ')'"
                th:text="${category.categoryName}"></button>
                <!-- 하위 카테고리 표시 -->
                <div th:if="${category.children != null}"
                     th:id="'subcategories-' + ${category.categoryId}"
                     class="subcategories ml-3">
                    <button type="submit" th:each="child : ${category.children}"
                            th:name="searchCategory"
                            th:value="${child.categoryId}"
                            th:text="${child.categoryName}"
                            class="btn btn-outline-secondary ml-2">
                    </button>
                </div>
            </div>
        </div>
    </form>

    <!-- 전체 상품 목록 섹션 -->
    <div class="row mt-5">
        <h2>상품 목록</h2>
        <div class="col-md-4 mb-4" th:each="food : ${foods}">
            <div class="card">
                <img th:src="${food.foodImg != null ? food.foodImg : '/images/default-image.jpg'}"
                     class="card-img-top" th:alt="${food.foodName}" />
                <div class="card-body">
                    <h5 class="card-title" th:text="${food.foodName}"></h5>
                    <p class="card-text" th:text="${food.foodLprice} + '원'"></p>
                    <a th:href="@{/product/{foodProductId}(foodProductId=${food.foodProductId})}"
                       class="btn btn-primary" th:if="${food.foodProductId != null}">구매하기</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function toggleSubcategories(categoryId) {
        var subcategoriesDiv = document.getElementById('subcategories-' + categoryId);
        if (subcategoriesDiv.style.display === "none" || subcategoriesDiv.style.display === "") {
            subcategoriesDiv.style.display = "block";
        } else {
            subcategoriesDiv.style.display = "none";
        }
    }
</script>
</body>
</html>

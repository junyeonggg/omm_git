<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>쇼핑몰</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/shop.css" rel="stylesheet"> <!-- CSS 파일 링크 -->
</head>
<body>
<div class="container my-5">
    <!-- 배너 이미지 섹션 -->
    <div id="bannerCarousel" class="carousel slide mb-5" data-bs-ride="carousel">
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#bannerCarousel"
                    th:each="banner, stat : ${bannerImages}"
                    th:classappend="${stat.index == 0} ? 'active'"
                    th:data-bs-slide-to="${stat.index}"
                    th:aria-current="${stat.index == 0} ? 'true' : null"
                    aria-label="Slide"></button>
        </div>
        <div class="carousel-inner">
            <div th:each="banner, stat : ${bannerImages}" th:classappend="${stat.index == 0} ? 'carousel-item active' : 'carousel-item'">
                <img th:src="@{${banner}}" class="d-block w-100" th:alt="'Banner Image ' + ${stat.index + 1}" />
                <div class="carousel-caption d-none d-md-block">
                    <h5>프로모션 제목</h5>
                    <p>프로모션 설명</p>
                    <a href="#" class="btn btn-primary">자세히 보기</a>
                </div>
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#bannerCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#bannerCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>

    <!-- 검색 및 카테고리 필터링 섹션 -->
    <h1>쇼핑몰</h1>
    <form class="mb-4" method="get" th:action="@{/shop}">
        <input type="text" name="query" placeholder="검색어를 입력하세요" class="form-control mb-2" />
        <!-- searchCategory 버튼 -->
        <div class="d-flex flex-wrap">
            <button type="submit" name="searchCategory" value="" class="btn btn-outline-secondary category-btn">전체 카테고리</button>
            <button type="submit" th:each="food : ${foods}"
                    th:if="${food != null and food.searchCategory != null}"
                    th:name="searchCategory"
                    th:value="${food.searchCategory}"
                    th:text="${food.searchCategory}"
                    class="btn btn-outline-primary category-btn">
            </button>
        </div>
    </form>

    <!-- 카테고리별 상품 추천 섹션 -->
    <div class="mt-5">
        <h2>카테고리별 추천 상품</h2>
        <div th:each="category : ${categories}">
            <h3 th:text="${category.category_name}"></h3>
            <div class="row">
                <div class="col-md-3 mb-4" th:each="food : ${categoryRecommendations[category.category_id]}">
                    <div class="card">
                        <!-- 이미지가 있을 경우 -->
                        <img th:if="${food != null and food.foodImg != null}" th:src="${food.foodImg}" class="card-img-top" th:alt="${food.foodName}" />
                        <!-- 이미지가 없을 경우 기본 이미지로 대체 -->
                        <img th:if="${food == null or food.foodImg == null}" th:src="@{/images/default-image.jpg}" class="card-img-top" th:alt="'No Image Available'" />
                        <div class="card-body">
                            <h5 class="card-title" th:text="${food != null ? food.foodName : '상품 이름 없음'}"></h5>
                            <p class="card-text" th:text="${food != null ? (food.foodLprice != null ? food.foodLprice + '원' : '가격 정보 없음') : '정보 없음'}"></p>
                            <a th:href="${food != null ? food.foodLink : '#'}"
                               class="btn btn-primary"
                               th:if="${food != null and food.foodLink != null}"
                               target="_blank">구매하기</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 전체 상품 목록 섹션 -->
    <div class="row mt-5">
        <h2>전체 상품 목록</h2>
        <div class="col-md-4 mb-4" th:each="food : ${foods}">
            <div class="card">
                <!-- 이미지가 있을 경우 -->
                <img th:if="${food != null and food.foodImg != null}" th:src="${food.foodImg}" class="card-img-top" th:alt="${food.foodName}" />
                <!-- 이미지가 없을 경우 기본 이미지로 대체 -->
                <img th:if="${food == null or food.foodImg == null}" th:src="@{/images/default-image.jpg}" class="card-img-top" th:alt="'No Image Available'" />
                <div class="card-body">
                    <!-- 제목이 없을 경우 기본 값 설정 -->
                    <h5 class="card-title" th:text="${food != null ? food.foodName : '상품 이름 없음'}"></h5>
                    <!-- 가격이 없을 경우 기본 값 설정 -->
                    <p class="card-text" th:text="${food != null ? (food.foodLprice != null ? food.foodLprice + '원' : '가격 정보 없음') : '정보 없음'}"></p>
                    <!-- 링크가 없을 경우 버튼 비활성화 -->
                    <a th:href="${food != null ? food.foodLink : '#'}"
                       class="btn btn-primary"
                       th:if="${food != null and food.foodLink != null}"
                       target="_blank">구매하기</a>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

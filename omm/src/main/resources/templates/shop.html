<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>쇼핑몰</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/shop.css" rel="stylesheet"> <!-- Updated CSS 파일 경로 -->
    <style>
        .subcategories {
            display: none; /* 기본적으로 숨김 */
        }
         .col-md-2 {
            flex: 0 0 auto;
            width: 20%; /* 한 행에 5개 */
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <!-- 브랜드명이나 로고 -->
        <a class="navbar-brand" href="/">Your Brand</a>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <!-- 중앙에 위치한 항목 (예: 네비게이션 링크) -->
            <ul class="navbar-nav me-auto">
                <!-- 여기에 다른 네비게이션 항목이 있을 수 있습니다 -->
            </ul>
            <!-- 오른쪽에 위치한 로그인/회원가입 버튼 -->
            <ul class="navbar-nav">
                <li sec:authorize="isAuthenticated()" class="nav-item"><a class="nav-link active" th:href="@{/profile}">마이페이지</a></li>
                <li sec:authorize="isAnonymous()" class="nav-item"><a class="nav-link active" th:href="@{/login}">로그인</a></li>
                <li sec:authorize="isAuthenticated()" class="nav-item"><a class="nav-link active" th:href="@{/logout}">로그아웃</a></li>
                <li sec:authorize="isAuthenticated()" class="nav-item"><a class="nav-link active" th:href="@{/inquire}">문의하기</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/join}">회원가입</a></li>
            </ul>
        </div>
    </div>
</nav>
<div class="container my-5">
    <h1>쇼핑몰</h1>

    <!-- 검색 및 카테고리 필터링 섹션 -->
    <form class="mb-4" method="get" th:action="@{/shop}">
        <input type="text" name="query" placeholder="검색어를 입력하세요" class="form-control mb-2" />
        <div class="d-flex flex-wrap category-btn-group"> <!-- 카테고리 버튼 그룹 추가 -->
            <!-- 전체 카테고리 버튼 -->
            <button type="submit" name="searchCategory" value="" class="btn btn-outline-secondary category-btn">전체</button>

            <!-- 상위 카테고리 버튼들 -->
            <div th:each="category : ${categories}">
                <button type="button" class="btn btn-outline-primary category-btn"
                th:id="'category-' + ${category.categoryId}"
                th:onclick="'toggleSubcategories(' + ${category.categoryId} + ')'"
                th:text="${category.categoryName}"></button>
                <!-- 하위 카테고리 표시 -->
                <div th:if="${category.children != null}"
                     th:id="'subcategories-' + ${category.categoryId}"
                     class="subcategories ml-3">
                    <button type="submit" th:each="child : ${category.children}"
                            th:name="searchCategory"
                            th:value="${child.categoryId}"
                            th:text="${child.categoryName}"
                            class="btn btn-outline-secondary ml-2">
                    </button>
                </div>
            </div>
        </div>
    </form>

    <!-- 전체 상품 목록 섹션 -->
    <div class="container my-5">
        <h2>상품 목록</h2>
        <div class="row mt-5">
            <div class="col-md-2 mb-4" th:each="food : ${foods}">
                <div class="card">
                    <img th:src="${food.foodImg != null ? food.foodImg : '/images/default-image.jpg'}"
                         class="card-img-top" th:alt="${food.foodName}" />
                    <div class="card-body">
                        <h5 class="card-title" th:text="${food.foodName}"></h5>
                        <p class="card-text" th:text="${food.foodLprice} + '원'"></p>
                        <a th:href="@{/product/{foodProductId}(foodProductId=${food.foodProductId})}"
                           class="btn btn-primary" th:if="${food.foodProductId != null}">구매하기</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- 페이징 네비게이션 -->
        <nav aria-label="Page navigation" class="mt-4">
            <ul class="pagination justify-content-center">
                <!-- 이전 페이지 버튼 -->
                <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                    <a class="page-link" th:href="@{/shop(query=${query}, searchCategory=${searchCategory}, page=${currentPage - 1})}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                <!-- 페이지 번호 버튼 -->
                <li class="page-item" th:each="i : ${#numbers.sequence(startPage, endPage)}"
                    th:classappend="${i == currentPage} ? 'active'">
                    <a class="page-link" th:href="@{/shop(query=${query}, searchCategory=${searchCategory}, page=${i})}" th:text="${i}"></a>
                </li>
                <!-- 다음 10페이지로 이동 버튼 -->
                <li class="page-item" th:classappend="${endPage >= totalPages} ? 'disabled'">
                    <a class="page-link" th:href="@{/shop(query=${query}, searchCategory=${searchCategory}, page=${endPage + 1})}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</div>
    <footer class="py-5 bg-dark">
        <div class="container"><p class="m-0 text-center text-white">&copy; Your Website 2023</p></div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function toggleSubcategories(categoryId) {
            var subcategoriesDiv = document.getElementById('subcategories-' + categoryId);
            if (subcategoriesDiv.style.display === "none" || subcategoriesDiv.style.display === "") {
                subcategoriesDiv.style.display = "block";
            } else {
                subcategoriesDiv.style.display = "none";
            }
        }
    </script>
</body>
</html>
